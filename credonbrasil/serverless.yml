org: credonbrasil
app: credonbrasilapp
service: credonbrasilservice

provider:
  name: aws
  runtime: nodejs20.x
  region: us-east-1
  timeout: 6  # Reduzido de 10s -> 6s (economia ~40%)
  memorySize: 512  # Otimizado para performance/custo
  environment:
    # Credenciais Hardcoded conforme solicitado
    DB_HOST: "credonbrasil.cqzygi8o8twk.us-east-1.rds.amazonaws.com"
    DB_USER: "root"
    # Aspas são obrigatórias aqui devido aos caracteres especiais
    DB_PASSWORD: "jahdaj7652635%Hod00HJsdbRms" 
    DB_NAME: "credonBrasil"
    # Configurações de conexão otimizadas para custo
    DB_CONN_LIMIT: "3"  # Reduzido de 5 -> 3
    DB_QUEUE_LIMIT: "50"  # Reduzido de 100 -> 50
    DB_CONNECT_TIMEOUT: "5000"  # Reduzido de 10s -> 5s

  httpApi:
    cors:
      allowedOrigins:
        - '*'
      allowedMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      allowedHeaders:
        - Content-Type
        - Authorization
        - X-Amz-Date
        - X-Api-Key
        - X-Amz-Security-Token

functions:
  # Funções leves e rápidas
  login:
    handler: handler.login
    timeout: 4  # Login é rápido
    events:
      - httpApi:
          path: /parceiros/login
          method: post

  getUserData:
    handler: handler.getUserData
    timeout: 3  # Muito simples, 1 query apenas
    events:
      - httpApi:
          path: /parceiros/me
          method: get

  adminLogin:
    handler: handler.adminLogin
    timeout: 4  # Login é rápido
    events:
      - httpApi:
          path: /admin/login
          method: post

  # Funções de supervisor
  supervisorLogin:
    handler: handler.supervisorLogin
    timeout: 4  # Login é rápido
    events:
      - httpApi:
          path: /supervisor/login
          method: post

  supervisorCadastro:
    handler: handler.supervisorCadastro
    timeout: 6  # Hash + validações
    events:
      - httpApi:
          path: /supervisor/cadastro
          method: post

  getSupervisorData:
    handler: handler.getSupervisorData
    timeout: 3  # Muito simples, 1 query apenas
    events:
      - httpApi:
          path: /supervisor/me
          method: get

  supervisorListParceiros:
    handler: handler.supervisorListParceiros
    timeout: 8  # Pode listar muitos registros
    memorySize: 256  # Menos memória para economizar
    events:
      - httpApi:
          path: /supervisor/parceiros
          method: get

  supervisorGetParceiro:
    handler: handler.supervisorGetParceiro
    timeout: 4  # 1 parceiro apenas
    events:
      - httpApi:
          path: /supervisor/parceiros/view
          method: get

  # Funções de cadastro (podem ser mais lentas)
  cadastro:
    handler: handler.cadastro
    timeout: 6  # Hash + validações
    events:
      - httpApi:
          path: /parceiros/cadastro
          method: post

  adminCadastro:
    handler: handler.adminCadastro
    timeout: 6  # Hash + validações
    events:
      - httpApi:
          path: /admin/cadastro
          method: post

  preCadastro:
    handler: handler.preCadastro
    timeout: 5  # Validações + insert
    events:
      - httpApi:
          path: /parceiros/pre-cadastro
          method: post

  # Funções admin mais pesadas
  adminListParceiros:
    handler: handler.adminListParceiros
    timeout: 8  # Pode listar muitos registros
    memorySize: 256  # Menos memória para economizar
    events:
      - httpApi:
          path: /admin/parceiros
          method: get

  adminGetParceiro:
    handler: handler.adminGetParceiro
    timeout: 4  # 1 parceiro apenas
    events:
      - httpApi:
          path: /admin/parceiros/view
          method: get

  adminUpdateParceiroSenha:
    handler: handler.adminUpdateParceiroSenha
    timeout: 5  # Hash + update
    events:
      - httpApi:
          path: /admin/parceiros/senha
          method: put

  # Novos endpoints para pré-cadastros
  adminListPreCadastros:
    handler: handler.adminListPreCadastros
    timeout: 8  # Pode listar muitos registros
    memorySize: 256  # Menos memória para economizar
    events:
      - httpApi:
          path: /admin/pre-cadastros
          method: get

  adminGetPreCadastro:
    handler: handler.adminGetPreCadastro
    timeout: 4  # 1 pré-cadastro apenas
    events:
      - httpApi:
          path: /admin/pre-cadastros/view
          method: get

  adminUpdatePreCadastroStatus:
    handler: handler.adminUpdatePreCadastroStatus
    timeout: 5  # Update + validações
    events:
      - httpApi:
          path: /admin/pre-cadastros/status
          method: put

  # Novo endpoint para transformar pré-cadastro em parceiro
  adminTransformarParceiro:
    handler: handler.adminTransformarParceiro
    timeout: 6  # Insert + hash + delete
    events:
      - httpApi:
          path: /admin/pre-cadastros/transformar-parceiro
          method: post

  # =============================================
  # ENDPOINTS PARA OPERAÇÕES
  # =============================================
  
  # Criar nova operação
  criarOperacao:
    handler: handler.criarOperacao
    timeout: 8  # Pode ser pesado com uploads
    events:
      - httpApi:
          path: /operacoes/criar
          method: post

  # Listar operações de um parceiro
  listarOperacoesParceiro:
    handler: handler.listarOperacoesParceiro
    timeout: 6  # Lista + estatísticas
    events:
      - httpApi:
          path: /operacoes/parceiro
          method: get

  # Buscar operação específica
  buscarOperacao:
    handler: handler.buscarOperacao
    timeout: 4  # Query simples
    events:
      - httpApi:
          path: /operacoes/buscar
          method: get

  # Atualizar operação
  atualizarOperacao:
    handler: handler.atualizarOperacao
    timeout: 5  # Update dinâmico
    events:
      - httpApi:
          path: /operacoes/atualizar
          method: put

  # Upload de documento
  uploadDocumento:
    handler: handler.uploadDocumento
    timeout: 10  # Upload pode ser lento
    memorySize: 1024  # Mais memória para processar arquivos
    events:
      - httpApi:
          path: /operacoes/upload-documento
          method: post

  # =============================================
  # ADMIN - OPERAÇÕES
  # =============================================
  adminListOperacoes:
    handler: handler.adminListOperacoes
    timeout: 8
    events:
      - httpApi:
          path: /admin/operacoes
          method: get

  adminGetOperacao:
    handler: handler.adminGetOperacao
    timeout: 4
    events:
      - httpApi:
          path: /admin/operacoes/view
          method: get

  adminUpdateOperacaoStatus:
    handler: handler.adminUpdateOperacaoStatus
    timeout: 5
    events:
      - httpApi:
          path: /admin/operacoes/status
          method: put

